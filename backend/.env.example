# Anonymous Chat Backend - Environment Configuration
# -----------------------------------------------------------------------------
# Copy this file to .env and modify as needed

# Application Configuration
NODE_ENV=development
PORT=3000
API_PREFIX=api/v1

# MongoDB Configuration
MONGODB_URI=mongodb://localhost:27017/anonymous-chat
MONGODB_DB_NAME=anonymous-chat

# Redis Configuration (Required for horizontal scaling)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_KEY_PREFIX=anon-chat:

# Redis retry configuration
REDIS_MAX_RETRIES=10
REDIS_RETRY_DELAY_MS=500
REDIS_MAX_RETRY_DELAY_MS=5000

# BullMQ Queue Configuration
BULLMQ_PREFIX=anon-chat

# CORS Configuration (Comma-separated list of allowed origins)
CORS_ORIGINS=http://localhost:5173,http://localhost:4173,http://localhost:8080
CORS_MAX_AGE=86400

# Cache TTL Configuration (in seconds)
# --------------------------------------------
# Session cache TTL (24 hours)
CACHE_TTL_SESSION=86400
# Presence TTL (1 minute)
CACHE_TTL_PRESENCE=60
# Room cache TTL (1 hour)
CACHE_TTL_ROOM=3600
# User rooms cache TTL (30 minutes)
CACHE_TTL_USER_ROOMS=1800
# Message cache TTL (30 minutes)
CACHE_TTL_MESSAGE=1800
# History list cache TTL (1 minute)
CACHE_TTL_HISTORY_LIST=60
# Message count cache TTL (5 minutes)
CACHE_TTL_MESSAGE_COUNT=300

# Room Configuration
# --------------------------------------------
# Default max participants per room
DEFAULT_MAX_PARTICIPANTS=10
# Default room expiration (hours)
DEFAULT_ROOM_EXPIRY_HOURS=24
# Minimum participants allowed
MIN_PARTICIPANTS=2
# Maximum participants allowed
MAX_PARTICIPANTS=100
# Minimum room expiry (hours)
MIN_ROOM_EXPIRY_HOURS=1
# Maximum room expiry (hours)
MAX_ROOM_EXPIRY_HOURS=168

# Message Configuration
# ---------------------------------------------
# Maximum message length
MAX_MESSAGE_LENGTH=2000
# Default message fetch limit
DEFAULT_MESSAGE_LIMIT=50
# Maximum message fetch limit
MAX_MESSAGE_LIMIT=100

# Session Configuration
# ----------------------------------------------
SESSION_TTL_HOURS=24
# Session cleanup TTL in days (for MongoDB TTL index)
SESSION_CLEANUP_DAYS=30

# Rate Limiting Configuration (Throttler)
# Protects against DoS and brute force attacks
# -----------------------------------------------------------------------------
# Short-term rate limit: max requests per TTL (1 second)
THROTTLE_SHORT_LIMIT=10
THROTTLE_SHORT_TTL_MS=1000

# Medium-term rate limit: max requests per TTL (10 seconds)
THROTTLE_MEDIUM_LIMIT=50
THROTTLE_MEDIUM_TTL_MS=10000

# Long-term rate limit: max requests per TTL (1 minute)
THROTTLE_LONG_LIMIT=200
THROTTLE_LONG_TTL_MS=60000

# -----------------------------------------------------------------------------
# WebSocket Rate Limiting
# Protects against spam and abuse
# -----------------------------------------------------------------------------
# Rate limit window in milliseconds
WS_RATE_LIMIT_WINDOW_MS=10000

# Message rate limit (per window)
WS_MESSAGE_RATE_LIMIT=25
# Typing rate limit (per window)
WS_TYPING_RATE_LIMIT=50
# Reaction rate limit (per window)
WS_REACTION_RATE_LIMIT=15
# Delete rate limit (per window)
WS_DELETE_RATE_LIMIT=5
# Join rate limit window (1 minute)
WS_JOIN_RATE_LIMIT=10
WS_JOIN_RATE_LIMIT_WINDOW_MS=60000
# Default event rate limit (per window)
WS_DEFAULT_RATE_LIMIT=100

# Block duration for rate limit violations (in milliseconds)
WS_RATE_LIMIT_BLOCK_DURATION_MS=10000
